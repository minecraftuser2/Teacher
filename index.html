<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>No Speaking or else</title>
</head>
<body>
  <h1>no speaking</h1>
  <button id="startBtn">Start</button>
  <audio id="adAudio" src="https://minecraftuser2.github.io/Teacher/school-ad.mp3"></audio>

  <script>
    const startBtn = document.getElementById('startBtn');
    const adAudio = document.getElementById('adAudio');

    startBtn.addEventListener('click', async () => {
      startBtn.disabled = true;
      startBtn.innerText = 'Listening...';

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const source = context.createMediaStreamSource(stream);
        const analyser = context.createAnalyser();
        source.connect(analyser);
        analyser.fftSize = 256;

        const dataArray = new Uint8Array(analyser.frequencyBinCount);

        let adPlaying = false;

        function detectNoise() {
          analyser.getByteFrequencyData(dataArray);
          const avg = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;

          if (avg > 15 && !adPlaying) {
            adPlaying = true;
            adAudio.play().catch(console.error);
          }

          adAudio.onended = () => {
            adPlaying = false;
          };

          requestAnimationFrame(detectNoise);
        }

        detectNoise();
      } catch (err) {
        console.error('Mic access error:', err);
        alert('Microphone access is required.');
      }
    });
  </script>
</body>
</html>
